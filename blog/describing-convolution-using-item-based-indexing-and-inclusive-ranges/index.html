<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Describing convolution using item-based indexing and inclusive ranges | nyanpasu64’s blog [OLD]</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Describing convolution using item-based indexing and inclusive ranges" />
<meta name="author" content="nyanpasu64" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is a follow-up to my previous post, “The gridline mental model of indexing and slicing”. I split this out because it’s related to DSP as well as programming, and may not be as interesting to the broader programming audience." />
<meta property="og:description" content="This is a follow-up to my previous post, “The gridline mental model of indexing and slicing”. I split this out because it’s related to DSP as well as programming, and may not be as interesting to the broader programming audience." />
<link rel="canonical" href="https://nyanpasu64.gitlab.io/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/" /><meta http-equiv="refresh" content="0; URL=https://nyanpasu64.gitlab.io/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/">
<meta property="og:url" content="https://nyanpasu64.gitlab.io/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/" />

<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-08T13:54:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Describing convolution using item-based indexing and inclusive ranges" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"nyanpasu64"},"dateModified":"2020-05-08T13:54:00-07:00","datePublished":"2020-05-08T13:54:00-07:00","description":"This is a follow-up to my previous post, “The gridline mental model of indexing and slicing”. I split this out because it’s related to DSP as well as programming, and may not be as interesting to the broader programming audience.","headline":"Describing convolution using item-based indexing and inclusive ranges","mainEntityOfPage":{"@type":"WebPage","@id":"https://nyanpasu64.github.io/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/"},"url":"https://nyanpasu64.github.io/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://nyanpasu64.github.io/feed.xml" title="nyanpasu64's blog [OLD]" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">nyanpasu64&#39;s blog [OLD]</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <a class="page-link" href="https://nyanpasu64.gitlab.io/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/">New site</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Describing convolution using item-based indexing and inclusive ranges</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-05-08T13:54:00-07:00" itemprop="datePublished">May 8, 2020
      </time></p>
      <a class="page-link" href="https://nyanpasu64.gitlab.io/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/">This site has moved!</a>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><em>This is a follow-up to my previous post, <a href="../the-gridline-mental-model-of-indexing-and-slicing">“The gridline mental model of indexing and slicing”</a>. I split this out because it’s related to DSP as well as programming, and may not be as interesting to the broader programming audience.</em></p>

<hr />

<p>In some cases, it’s useful to think of array indices as pointing to individual items (not fenceposts), and represent sets of items using inclusive ranges. For example, in DSP (digital signal processing), “signals” are effectively arrays of samples (AKA amplitudes) at signed-integer indices. If you have a signal of length N starting at index 0, you can treat it as an infinite signal that’s only nonzero at indices <code class="language-plaintext highlighter-rouge">[0, N-1]</code> inclusive. All other indices (negative indices, and indices N and above) have a value of zero.</p>

<p>Convolution is a process where you “spread out” each nonzero element in a signal by an “impulse response”. One example of convolution is taking a picture with a shaky or defocused camera, where we assume all objects in the image are distorted or defocused equally.</p>

<p>Every point of light is smudged into a blob or streak. If you assume the point of light starts at an “original position”, the blob or streak is an image (two-dimensional signal) which maps positions (relative to the point of light) onto intensities. This signal is known as an “impulse response”. Every object gets “smudged” by that impulse response (blob or streak). This process of “smudging” is convolving the image by the impulse response.</p>

<p>Convolution also applies to 1-dimensional signals like audio. Filtering or adding reverb to audio is convolving the signal by an impulse response (which is the result of sending a short impulse or pop through the filter/reverb).</p>

<p>If you convolve (or smudge) a one-dimensional signal of length <code class="language-plaintext highlighter-rouge">L</code> (which can only be nonzero at indices <code class="language-plaintext highlighter-rouge">[0, L-1]</code>) by an impulse response of length <code class="language-plaintext highlighter-rouge">P</code> (which can only be nonzero at indices <code class="language-plaintext highlighter-rouge">[0, P-1]</code>), the resulting signal can only be nonzero at indices <code class="language-plaintext highlighter-rouge">[0, (L-1) + (P-1)]</code> or <code class="language-plaintext highlighter-rouge">[0, L+P-2]</code>, and will have length <code class="language-plaintext highlighter-rouge">L+P-1</code>. (I think this formula also generalizes to two or more dimensions!)</p>

<h2 id="inclusive-ranges-in-block-convolution-very-technical">Inclusive ranges in block convolution (very technical)</h2>

<p>Convolving a long signal by a short kernel (aka impulse response) of length <code class="language-plaintext highlighter-rouge">P</code> is often faster if you split the long signal into chunks, then compute the output in blocks of length <code class="language-plaintext highlighter-rouge">L</code>. This is because the FFT has runtime O(N log N), and one large FFT can be slower than many smaller FFTs.</p>

<p>One method is overlap-add convolution. If you break a long signal into blocks of length <code class="language-plaintext highlighter-rouge">L</code>, each block is only nonzero between <code class="language-plaintext highlighter-rouge">[0, L-1]</code>. And if your filter kernel has length <code class="language-plaintext highlighter-rouge">P</code> and starts at index 0, it’s only nonzero between <code class="language-plaintext highlighter-rouge">[0, P-1]</code>. And if you convolve signals of length <code class="language-plaintext highlighter-rouge">L</code> and <code class="language-plaintext highlighter-rouge">P</code>, the largest index with nonzero amplitude is <code class="language-plaintext highlighter-rouge">L+P-2</code>. And the resulting signal has support <code class="language-plaintext highlighter-rouge">[0, L+P-2]</code> and length <code class="language-plaintext highlighter-rouge">L+P-1</code>.</p>

<p>Another example is overlap-save convolution. If you pick a block of <code class="language-plaintext highlighter-rouge">L+P-1</code> samples from the input signal, the <em>beginning</em> of each convolution output is corrupted and must be discarded. In particular, trailing samples at indices ≤ <code class="language-plaintext highlighter-rouge">-1</code> are spread out by a filter kernel of support <code class="language-plaintext highlighter-rouge">[0, P-1]</code>, corrupting outputs <code class="language-plaintext highlighter-rouge">[0, P-2]</code>, forcing you to discard the first <code class="language-plaintext highlighter-rouge">P-1</code> samples. If you don’t prepend zeros to the input signal, overlap-save convolution loses the first <code class="language-plaintext highlighter-rouge">P-1</code> samples of the input/output.</p>

<h2 id="credits">Credits</h2>

<p>Thanks to ax6 for helping me edit this article.</p>

  </div>

  <script src="https://utteranc.es/client.js"
        repo="nyanpasu64/nyanpasu64.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  <a class="u-url" href="/blog/describing-convolution-using-item-based-indexing-and-inclusive-ranges/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <!-- <h2 class="footer-heading">nyanpasu64&#39;s blog [OLD]</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            nyanpasu64&#39;s blog [OLD]
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/nyanpasu64"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">nyanpasu64</span></a></li><li><a href="https://write.as/nyanpasu64"><span class="username">My microblog</span></a></li>
</ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Adventures in programming, DSP, and chiptune</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
